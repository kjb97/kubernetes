## 1. Multi Tenant 환경
RAM 스토리지와 여러 CPU 코어를 자유롭게 사용할 수 있는 물리적 서버가 아래에 있고, 이 하드웨어 위에 운영 체제를 설치.</br>
그리고 하이퍼바이저가 운영 체제에 설치.</br>
마지막으로 여러 가상 시스템을 분할하여 필요에 따라 RAM 및 CPU 코어를 할당.</br>
따라서 각 가상 시스템은 서로 다른 운영 체제를 실행 가능. </br>
중요한 점은 모든 가상 시스템이 고유한 운영 체제를 가지고 있고, 더 중요한 것은 전용 커널을 가지고 있다는 것.</br></br>

클라우드의 가상 시스템에도 동일한 사항이 적용.  
AWS, Azure, GCP 또는 다른 클라우드 프로바이더에 관계없이 클라우드에서 생성하는 모든 VM은 자체 전용 커널을 사용.  
그래서 동일한 물리적 인프라에서 실행되는 가상 시스템 간에 강력한 격리가 가능.  
가상 머신이 제공하는 강력한 격리 기능으로 인해 가상 머신을 사용하여 다양한 환경을 여러 사용자에게 안전하게 호스팅할 수 있다.  

이러한 설정을 MultiTenant 환경이라고도 합니다.

## VM과 Container의 차이
주요 차이점 중 하나는 가상 시스템에서 실행 중이든 물리적 서버에서 실행 중이든 서버의 모든 컨테이너가 동일한 기본 커널을 공유한다는 것.  
호스트의 관점에서 보면 호스트 및 호스트에서 실행 중인 다른 컨테이너와 분리된 또 다른 프로세스일 뿐이다.  
예를 들어, 1,000초 동안 절전 모드로 전환되는 BusyBox 컨테이너가 있을 때,  
이 컨테이너는 PID가 1인 컨테이너 내에서 루트 사용자로서 sleep 명령을 실행.  
컨테이너를 실행한 호스트에서 PS 명령을 실행하는 경우 호스트에서 동일한 프로세스가 실행되고 있지만 PID가 다른 것을 확인할 수 있다.  
컨테이너 내부 process와 호스트의 process가 각각 하나씩 실행 중.  

이를 Process ID Namespace라고 하며, 컨테이너가 프로세스를 서로 격리하는 방법이다.  
호스트에서 모든 컨테이너가 실행 중인 것.  
OS에 직접 배포하든 컨테이너로 배포하든 애플리케이션은 호스트에서 실행된다.  
그래서 결국은 둘 다 호스트의 하드웨어 자원을 사용한다는 점은 동일하다.  

그러나 전용 커널이 있는 VM은 자체 커널을 가지고 있지만 컨테이너는 동일한 커널(호스트의 커널)을 공유한다.
호스트의 모든 컨테이너는 동일한 커널에 syscall을 수행하여 동작하기 때문에
Dirty COW와 같은 공격을 사용하여 컨테이너에서 취약한 커널을 실행하는 호스트로 침입하는 등의 취약점이 생긴다.
손상된 컨테이너는 호스트에 대한 백도어 항목을 생성할 수 있기 때문에 호스트에서 실행 중인 다른 모든 컨테이너를 손상시킬 수 있다.

이 문제를 해결하기 위해서 sandbox를 이용한다.

## Sandbox
IT 분야에서 sandbox는 여러 의미가 있을 수 있지만, 보안에서 sandbox는 격리 기술을 의미.

Docker는 기본 Seccomp 프로필을 사용하여 컨테이너가 잠재적으로 위험한 시스템 호출을 수행할 수 없도록 한다.
Seccomp를 Kubernetes에서 사용하고 컨테이너를 응용 프로그램 실행에 필요한 최소한의 권한으로 제한한다.
또한 AppArmor profile을 사용하여 컨테이너가 액세스할 수 있는 리소스를 세부적으로 제어하는 방법도 있다.
이 두 기술은 비슷하게 동작한다.

컨테이너에서 허용된 작업을 화이트리스트에 추가하고, 허용하지 않는 작업을 블랙리스트에 추가.
화이트리스트는 기본적으로 모든 항목을 차단하고
모든 syscall을 기본 동작으로 차단하는 Seccomp 프로필의 경우와 같다.
