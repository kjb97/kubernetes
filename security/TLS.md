## TLS

인증서는 거래 중에 두 당사자 간의 신뢰를 보장하는 데 사용한다.  
예를 들어, 사용자가 웹 서버에 액세스하려고 할 때,  
TLS 인증서는 사용자와 서버 간의 통신이 암호화와 서버의 신원을 보장한다.  
보안 연결이 없으면 사용자가 온라인 뱅킹에 액세스할 경우 입력한 자격 증명이 일반 텍스트 형식으로 전송된다.  
해커의 sniffing 네트워크 트래픽은 쉽게 자격 증명을 검색하여 사용자의 은행 계정을 해킹하는 데 사용할 수 있다.  
따라서 암호화 키를 사용하여 전송되는 데이터를 암호화해야 한다.    

- 대칭키 암호화  
A라는 키로 암호화하면 같은 A키로 복호화하는 방식.  
해커는 데이터를 얻을 수 있지만 암호화되어 알아볼 수 없는데  
데이터를 수신하는 서버도 알아볼 수 없다.  
키가 없으면 데이터의 암호를 해독할 수 없으므로  
서버가 해독할 수 있게 키의 복사본도 서버로 전송해야 한다.  
키도 동일한 네트워크를 통해 전송되기 때문에  
사실상 키를 탈취하면 암호화한 의미가 없어진다.

- 비대칭키 암호화(공개키)  
A,B 두 가지의 키를 이용하여 A키로 암호화하면 B키로만 복호화할 수 있고,  
B로 암호화하면 A키로만 복호화할 수 있다.  
키 쌍, 개인 키 및 공용 키를 사용.  
공용키로 데이터를 암호화하거나 잠그면 개인키로만 열 수 있다.  
예시로 SSH 액세스 보호가 있다.  
id/password 방식은 위험하기 때문에 키를 이용.  
1. id_rsa, id_rsa.pub 공용 및 개인 키 쌍을 생성.  
2. 서버의 ssh/authorized_keys 파일에 공용키 추가.  
3. 해당 서버 접근에 대해 이 공용키에 대응하는 개인키가 없으면 접근불가.    

**공개되어 있기 때문에 누구나 공용키를 이용할 수 있지만 그걸 복호화 하는 것은 개인키로만 가능하다.**
**개인키로 암호화하면 쌍인 공용키로만 해제할 수 있고 공용키로 암호화하면 개인키로만 해제할 수 있다.**

## HTTPS
웹에서의 인증을 보면,  
주체는 셋.  
사용자, 서버, CA (공인인증기관)  
브라우저는 CA 공용키 목록을 가지고 있다.    

1. 서버는 CA의 개인키로 암호화한 인증서를 가진다.  
2. 사용자가 서버에 요청을 보내면 서버가 이 인증서를 사용자에게 전달한다.  
3. 사용자 (브라우저)는 CA의 공개키로 이 인증서 복호화를 시도한다.  
4. 복호화에 성공하면 CA의 개인키로 암호화된 것이 맞으므로 인증된 서버임을 알 수 있다.  
5. 그러면 사용자는 서버의 공개키를 받는다.  
6. 인증에 성공했으니 계속해서 비대칭키 방식으로 통신하게되면 부하가 발생한다.  
7. 사용자는 대칭키를 만들고 이걸 서버의 공개키로 암호화한다.(비대칭키 방식)  
8. 해당 데이터를 받은 서버는 자신의 개인키로 해제하여 사용자가 생성한 대칭키를 받는다.  
9. 이 후부터 서버와 클라이언트 간에는 대칭키를 이용한 통신을 활성화한다.    

| 여기서 서버는 인증을 하지만 클라이언트에 대한 인증은 없다.  
| 클라이언트가 보낸 사용자 이름, 암호, 클라이언트 번호 등의 실제 데이터를 기반으로 짐작하는 것.  
| 이것이 단방향 SSL.  
| 일반 사용자와 서버 간 통신이라면 충분하지만  
| 만약 서버 간 통신이라면? 클라이언트와 서버 간 양방향 TLS가 필요하다.    

## mTLS
만약 A은행에서 B은행으로 데이터를 요청한다면?  
두 서버 간 서로의 인증이 모두 필요하다.  
클라이언트 쪽 인증이 추가되는 것 뿐이라 크게 달라지진 않는다.    

1. 두 서버는 모두 CA 인증서를 가지고 있다.  
2. 클라이언트가 요청을 보내면 서버는 CA 인증서를 클라이언트에게 보낸다.  
3. 클라이언트는 서버의 인증서를 확인하고 자신의 CA 인증서 + 서버의 공용키로 암호화한 대칭키를 서버로 보낸다.  
4. 서버가 클라이언트의 인증서를 확인하고 이 후, 대칭키를 통해 통신한다.  

